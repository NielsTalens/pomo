#!/usr/bin/env ruby

require_relative '../lib/pomo'
require 'thor'

module Pomo
  class CLI < Thor
    desc "start", "Start a new pomodoro cycle"
    def start
      puts "Starting Pomo cycle... (Press Ctrl+C to stop)".colorize(:green)
      cycle = Cycle.new
      
      trap("INT") do
        puts "\nStopping cycle...".colorize(:red)
        cycle.stop
        exit
      end
      
      cycle.start
    end
    
    desc "add TASK_NAME", "Add a new task to the list"
    def add(name)
      task_list = TaskList.new
      task_list.add(name)
      puts "Added: #{name}".colorize(:green)
    end
    
    desc "list", "Show all tasks"
    def list
      task_list = TaskList.new
      task_list.list
    end
    
    desc "complete INDEX", "Mark a task as completed"
    def complete(index)
      task_list = TaskList.new
      task_list.complete(index.to_i - 1)
      puts "Task #{index} completed!".colorize(:green)
      list
    end

    desc "reset INDEX", "Mark a task as pending"
    def reset(index)
      task_list = TaskList.new
      task_list.reset(index.to_i - 1)
      puts "Task #{index} reset to pending.".colorize(:green)
      list
    end

    desc "up INDEX", "Move task up one position"
    def up(index)
      TaskList.new.move_up(index.to_i - 1)
      list
    end

    desc "down INDEX", "Move task down one position"
    def down(index)
      TaskList.new.move_down(index.to_i - 1)
      list
    end

  end
end

Pomo::CLI.start(ARGV)