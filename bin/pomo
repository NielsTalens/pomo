#!/usr/bin/env ruby

require_relative '../lib/pomo'
require 'thor'

module Pomo
  class CLI < Thor
    desc "start", "Start a new pomodoro cycle"
    def start
      puts <<~ASCII.colorize(:cyan)
      ──────────────────────────────────────────

        ███████╗ ███████╗ ███╗  ███╗ ███████╗
        ██╔══██║ ██╔══██║ ████╗████║ ██╔══██║
        ██████╔╝ ██║  ██║ ██╔███╔██║ ██║  ██║
        ██║      ███████║ ██║ ╚═╝██║ ███████║
        ╚═╝      ╚══════╝ ╚═╝    ╚═╝ ╚══════╝
      ──────────────────────────────────────────
      ASCII
      puts "[ Starting Pomo cycle... (Press Ctrl+C to stop) ]".colorize(:green)
      puts "─────────────────────────────────────────────────".colorize(:green)

      ls

      print "\nPlease enter the number of the task to start with "
      print "\nor press Enter to start with the first pending task): "

      response = $stdin.gets.chomp
      chosen_task = response.empty? ? nil : response.to_i - 1

      cycle = Cycle.new
      
      trap("INT") do
        puts "\nStopping cycle...".colorize(:red)
        cycle.stop
        exit
      end
      
      cycle.start(chosen_task)
    end
    
    desc "add TASK_NAME", "Add a new task to the list"
    def add(name)
      task_list = TaskList.new
      task_list.add(name)
      puts "Added: #{name}".colorize(:green)
    end

    desc "rm INDEX", "Delete a task"
    def rm(index)
      task_list = TaskList.new
      task_list.delete(index.to_i - 1)
      puts "Task #{index} deleted!".colorize(:red)
      ls
    end
    
    desc "ls", "Show all tasks"
    def ls
      task_list = TaskList.new
      task_list.list
    end
    
    desc "comp INDEX", "Mark a task as completed"
    def comp(index)
      task_list = TaskList.new
      task_list.complete(index.to_i - 1)
      puts "Task #{index} completed!".colorize(:green)
      ls
    end

    desc "rs INDEX", "Mark a task as pending"
    def rs(index)
      task_list = TaskList.new
      task_list.reset(index.to_i - 1)
      puts "Task #{index} reset to pending.".colorize(:green)
      ls
    end

    desc "up INDEX", "Move task up one position"
    def up(index)
      TaskList.new.move_up(index.to_i - 1)
      ls
    end

    desc "down INDEX", "Move task down one position"
    def down(index)
      TaskList.new.move_down(index.to_i - 1)
      list
    end

  end
end

Pomo::CLI.start(ARGV)